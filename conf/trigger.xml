<?xml version="1.0" encoding="UTF-8"?>

<!--  example configuration file for the realtime fMRI system       -->
<!--  NOTE... ':' characters are not allowed in any names or values -->
<!--  Oliver Hinds <ohinds@mit.edu> 2007-09-12                      -->

<study
    subject="foobar"
    subjectsDir="/data/subjects"
    > </study>

<info>
  <terminal
      verbose="true"
      debug="false"
      > </terminal>

  <log
      filename="log/log.rtl"
      disabled="false"
      > </log>

  <errlog
      filename="log/log.rtl"
      disabled="false"
      > </errlog>
</info>

<scanner
    disabled="false"

    receiveImages="true"
    port="15000"
    saveImages="true"

    receiveTriggers="false"
    triggerSync="false"
    triggerCode="83"

    onlyReadMoCo="true"

    tr="2.0"
    measurements="136"

    matrixSize="64"
    numSlices="32"
    voxdim1="3.13"
    voxdim2="3.13"
    voxdim3="3.85"
> </scanner>

<display
    image="1"
    imageWinX="600"
    imageWinY="0"
    imageWinW="1000"
    imageWinH="1000"
    posOverlayID="data.image.activation.voxel-fluctmon"
    posOverlayRoiID="active"
    negOverlayID="data.image.activation.voxel-fluctmon"
    negOverlayRoiID="deactive"
    posMaskID="data.image.mask"
    posMaskRoiID="active"
    negMaskID="data.image.mask"
    negMaskRoiID="deactive"
    posActivationSumID="data.image.activation.activation-sum"
    posActivationSumRoiID="active"
    negActivationSumID="data.image.activation.activation-sum"
    negActivationSumRoiID="deactive"
>
</display>

<infoserver
    port="15001"
>
</infoserver>

<!-- preprocessing steps -->
<preprocessor>
  <output>display</output>

  <module name="voxel-difference">
    <output>display</output>
    <output>log</output>
  </module>

  <module name="voxel-mean">
    <option name="makeavail">true</option>
    <output>display</output>
  </module>

  <module name="voxel-variance">
    <option name="makeavail">true</option>
    <output>display</output>
  </module>

  <!-- positive activation region -->
  <module name="fluctuationmonitor">
    <option name="makeavail">true</option>
    <output>display</output>

    <option name="makeoutput">true</option>

    <option name="trends">2</option>
    <option name="probThreshold">0.05</option>
    <option name="correctForMultiComps">0</option>

    <option name="afterTriggerSkip">0</option>
<!--     <option name="numDataPointsForErrEst">25</option> -->
    <option name="maskSource">loadFromFile</option>
    <option name="roiID">active</option>
    <option name="maskFilename">mask/active_mask.nii</option>
    <option name="flipLRMask">true</option>
    <option name="maskToDisplay">true</option>

    <option name="dumpAlgoVars">false</option>
    <option name="dumpAlgoVarsFilename">log/fluct_algo.txt</option>

  </module>

  <!-- negative activation region -->
  <module name="fluctuationmonitor">
    <option name="makeavail">true</option>
    <output>display</output>

    <option name="makeoutput">true</option>

    <option name="trends">2</option>
    <option name="probThreshold">0.05</option>
    <option name="correctForMultiComps">0</option>

    <option name="afterTriggerSkip">0</option>
<!--     <option name="numDataPointsForErrEst">25</option> -->
    <option name="maskSource">loadFromFile</option>
    <option name="flipLRMask">true</option>
    <option name="roiID">deactive</option>
    <option name="maskFilename">mask/deactive_mask.nii</option>
    <option name="maskToDisplay">true</option>

  </module>

  <module name="activation-sum">
    <option name="makeavail">true</option>
    <output>infoserver</output>
    <output>display</output>
    <option name="roiID">active</option>
    <option name="activationID">data.image.activation.voxel-fluctmon</option>
  </module>

  <module name="activation-sum">
    <option name="makeavail">true</option>
    <output>infoserver</output>
    <output>display</output>
    <option name="roiID">deactive</option>
    <option name="activationID">data.image.activation.voxel-fluctmon</option>
  </module>

  <module name="event-trigger-activation-diff">
    <output>infoserver</output>
    <output>display</output>
    <output>data.image.activation.voxel-fluctuationmonitor</output>

    <option name="monitorPos">true</option>
    <option name="posroiID">active</option>

    <option name="monitorNeg">false</option>
    <option name="negroiID">deactive</option>

    <option name="diffThresh">0.75</option>

    <option name="initialSkipTRs">20</option>
    <option name="afterTriggerSkipTRs">10</option>
  </module>

</preprocessor>

