<?xml version="1.0" encoding="UTF-8"?>

<!--  example configuration file for the realtime fMRI system       -->
<!--  NOTE... ':' characters are not allowed in any names or values -->

<study
    subject="foobar"
    subjectsDir="/data/subjects/realtime"
    > </study>

<info>
  <terminal
      verbose="true"
      debug="false"
      > </terminal>

  <log
      filename="log/log.rtl"
      disabled="false"
      > </log>

  <errlog
      filename="log/log.rtl"
      disabled="false"
      > </errlog>
</info>

<scanner
    disabled="false"

    receiveImages="true"
    port="15000"
    saveImages="false"

    receiveTriggers="false"
    triggerSync="false"
    triggerCode="83"

    tr="2.0"
    measurements="200"

    matrixSize="32"
    numSlices="32"
    voxdim1="6.0"
    voxdim2="6.0"
    voxdim3="7.2"
> </scanner>

<display
    image="1"
    imageWinX="300"
    imageWinY="0"
    imageWinW="1000"
    imageWinH="1000"
    posOverlayID="data.image.activation.voxel-fluctmon"
    posOverlayRoiID="active"
    negOverlayID="data.image.activation.voxel-fluctmon"
    negOverlayRoiID="deactive"
    posMaskID="data.image.mask"
    posMaskRoiID="active"
    negMaskID="data.image.mask"
    negMaskRoiID="deactive"
    posActivationSumID="data.image.activation.activation-sum"
    posActivationSumRoiID="active"
    negActivationSumID="data.image.activation.activation-sum"
    negActivationSumRoiID="deactive"
>
</display>

<infoserver
    port="15001"
>
</infoserver>

<!-- preprocessing steps -->
<preprocessor>
  <output>display</output>

  <module name="intensity-norm">
    <option name="makeavail">true</option>
    <option name="makecurrent">true</option>

<!--     <option name="maskSource">loadFromFile</option> -->
<!--     <option name="roiID">active</option> -->
<!--     <option name="maskFilename">mask/brain_mask2.nii</option> -->
<!--     <option name="maskToDisplay">true</option> -->

    <option name="betMask">true</option>
    <option name="betParms">-f 0.5 -g 0 -n -m</option>
    <option name="maskScript">/home/ohinds/projects/realtime/system/scripts/make_bet_mask.sh</option>
    <output>display</output>
  </module>

  <module name="voxel-difference">
    <output>display</output>
    <output>log</output>
  </module>

<!--   <module name="voxel-mean"> -->
<!--     <option name="makeavail">true</option> -->
<!--     <output>display</output> -->
<!--   </module> -->

<!--   <module name="voxel-variance"> -->
<!--     <option name="makeavail">true</option> -->
<!--     <output>display</output> -->
<!--   </module> -->

  <!-- positive activation region -->
  <module name="fluctuationmonitor">
    <option name="makeavail">true</option>
    <output>display</output>

    <option name="trends">2</option>
    <option name="probThreshold">0.20</option>
    <option name="correctForMultiComps">0</option>

    <option name="maskSource">loadFromFile</option>
    <option name="roiID">active</option>
    <option name="maskFilename">mask/active_mask.nii</option>
    <option name="maskToDisplay">true</option>

  </module>

  <!-- negative activation region -->
  <module name="fluctuationmonitor">
    <option name="makeavail">true</option>
    <output>display</output>

    <option name="trends">2</option>
    <option name="probThreshold">0.20</option>
    <option name="correctForMultiComps">0</option>

    <option name="maskSource">loadFromFile</option>
    <option name="roiID">deactive</option>
    <option name="maskFilename">mask/deactive_mask.nii</option>
    <option name="maskToDisplay">true</option>

  </module>

  <module name="activation-sum">
    <option name="makeavail">true</option>
    <output>infoserver</output>
    <output>display</output>
    <option name="roiID">active</option>
    <option name="activationID">data.image.activation.voxel-fluctmon</option>
  </module>

  <module name="activation-sum">
    <option name="makeavail">true</option>
    <output>infoserver</output>
    <output>display</output>
    <option name="roiID">deactive</option>
    <option name="activationID">data.image.activation.voxel-fluctmon</option>
  </module>

<!--   <module name="event-trigger-activation-sums"> -->
<!--     <output>infoserver</output> -->
<!--     <output>display</output> -->

<!--     <option name="monitorPos">true</option> -->
<!--     <option name="posroiID">active</option> -->
<!--     <option name="posThresh">0.5</option> -->

<!--     <option name="monitorNeg">false</option> -->
<!--     <option name="negroiID">deactive</option> -->
<!--     <option name="negThresh">-0.1</option> -->

<!--     <option name="afterTriggerSkipTRs">10</option> -->
<!--   </module> -->

  <module name="event-trigger-activation-diff">
    <output>infoserver</output>
    <output>display</output>

    <option name="monitorPos">true</option>
    <option name="posroiID">active</option>

    <option name="monitorNeg">false</option>
    <option name="negroiID">deactive</option>

    <option name="diffThresh">0.5</option>

    <option name="afterTriggerSkipTRs">10</option>
  </module>

</preprocessor>
