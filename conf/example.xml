<?xml version="1.0" encoding="UTF-8"?>

<!--  example configuration file for the realtime fMRI system       -->
<!--  NOTE... ':' characters are not allowed in any names or values -->
<!--  Oliver Hinds <ohinds@mit.edu> 2007-09-12                      -->

<!-- basic setup of the study and subject -->
<study name="foo">
  <option name="subjectsDir"> /data/subjects </option>

  <subject name="bar">
  </subject>

  <terminal>
      <option name="verbose"> true </option>
      <option name="debug"> false </option>
  </terminal>

  <log>
      <option name="filename"> log.rtl </option>
      <option name="disabled"> false </option>
  </log>

  <errlog>
      <option name="filename"> log.rtl </option>
      <option name="disabled"> false </option>
  </errlog>

</study>

<!-- setup for connecting to and receiving images from the MRI scanner -->
<scanner>
  <!-- general options -->
  <option name="disabled">      false </option>
  <option name="receiveImages"> true </option>
  <option name="saveImages">    true </option>

  <!-- sacquisition type -->
  <option name="imageType">     epi </option>

  <!-- receiving parameters -->
  <option name="port">          15000 </option>
  <option name="onlyReadMoco">  true </option>
  <option name="unmosaic">      true </option>

  <!-- acquistion parameters -->
  <option name="tr"> 2.0 </option>
  <option name="measurements">   153 </option>
  <option name="matrixSize">      64 </option>
  <option name="slices">          32 </option>
  <option name="voxdim1">       3.13 </option>
  <option name="voxdim2">       3.13 </option>
  <option name="voxdim3">       3.85 </option>

</scanner>

<gui>

  <option name="disabled">true</option>

</gui>

<oldgui>
    <option name="disabled">     false </option>

    <option name="winX">         300 </option>
    <option name="winY">         0 </option>
    <option name="winW">         1000 </option>
    <option name="winH">         1000 </option>

    <option name="displayType">  data.image.mri </option>
    <option name="posOverlayID"> data.image.activation.voxel-fluctmon </option>
    <option name="posOverlayRoiID"> active </option>
    <option name="negOverlayID"> data.image.activation.voxel-fluctmon </option>
    <option name="negOverlayRoiID"> deactive </option>

    <option name="posMaskID"> data.image.mask </option>
    <option name="posMaskRoiID"> active </option>
    <option name="negMaskID"> data.image.mask </option>
    <option name="negMaskRoiID"> deactive </option>

    <option name="posActivationSumID"> data.image.activation.activation-sum </option>
    <option name="posActivationSumRoiID"> active </option>
    <option name="negActivationSumID"> data.image.activation.activation-sum </option>
    <option name="negActivationSumRoiID"> deactive </option>

</oldgui>

<infoserver
    disabled="false"
    port="15001"
>
</infoserver>

<!-- data processing steps -->
<processor>
  <output>display</output>

  <!-- intensity normalization-->
  <module name="intensity-norm">
    <option name="makeavail">true</option>
    <option name="makecurrent">true</option>

    <option name="betMask">true</option>
    <option name="betParms">-f 0.5 -g 0 -n -m</option>
    <option name="maskScript">/home/ohinds/projects/realtime/system/scripts/make_bet_mask.sh</option>
    <output>display</output>
  </module>

  <!-- voxel-wise image intensity difference between adjacent images -->
  <module name="voxel-difference">
    <output>display</output>
    <output>log</output>
  </module>

  <!-- incrementally computed mean voxel-intensity -->
  <module name="voxel-mean">
    <option name="makeavail">true</option>
    <output>display</output>
  </module>

  <!-- incrementally computed voxel-intensity variance -->
  <module name="voxel-variance">
    <option name="makeavail">true</option>
    <output>display</output>
  </module>

  <!-- incrementally computed voxel-intensity zscore -->
  <module name="voxel-zscore" threshold="3.0">
     <output>display</output>
  </module>

  <!-- incremental GLM  -->
  <module name="accumcor">
     <output>display</output>

     <option name="condition">
        0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1
     </option>

     <option name="trends">2</option>

     <option name="saveTVol">1</option>
     <option name="saveTVolName">mask/active_t.nii</option>

     <option name="savePosAsMask">1</option>
     <option name="saveNegAsMask">1</option>
     <option name="savePosAsMaskFilename">mask/active_mask.nii</option>
     <option name="saveNegAsMaskFilename">mask/background_mask.nii</option>
  </module>

  <!-- deviation of voxel intensity from expected value  -->
  <module name="singleimcor">
     <output>display</output>

     <option name="condition" conditionName="condName">
        0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1
     </option>

     <option name="trends">2</option>
     <option name="baselineThreshold">0.00001</option>
     <option name="probThreshold">0.10</option>
     <option name="correctForMultiComps">0</option>

     <option name="maskSource">loadFromFile</option>
     <option name="maskFilename">mask</option>
     <option name="maskToDisplay">true</option>

     <option name="roiID">active</option>
 
     <option name="dumpAlgoVars">false</option>
     <option name="dumpAlgoVarsFilename">log/algovars.txt</option>
      
  </module>

  <!-- deviation of voxel intensity from expected value with no regressors -->
  <module name="fluctuationmonitor">
    <option name="makeavail">true</option>
    <output>display</output>

    <option name="makeoutput">true</option>

    <option name="trends">2</option>
    <option name="probThreshold">0.05</option>
    <option name="correctForMultiComps">0</option>

    <option name="maskSource">loadFromFile</option>
    <option name="roiID">active</option>
    <option name="maskFilename">mask/active_mask.nii</option>
    <option name="maskToDisplay">true</option>

  </module>

  <!-- sums activation within an ROI -->
  <module name="activation-sum">
    <option name="makeavail">true</option>
    <output>infoserver</output>
    <output>display</output>
    <option name="roiID">active</option>
    <option name="activationID">data.image.activation.voxel-fluctmon</option>
  </module>

  <module name="activation-sum">
    <option name="makeavail">true</option>
    <option name="roiID">background</option>
  </module>

  <!-- computed the difference in activation between two activation sums -->
  <module name="activation-sum-difference">
    <output>infoserver</output>
    <output>display</output>
    <option name="posRoiID">active</option>
    <option name="negRoiID">background</option>
  </module>

  <!--  triggers events based on absolute values of activation sums -->
  <module name="event-trigger-activation-sums">
    <output>infoserver</output>
    <output>display</output>

    <option name="monitorPos">true</option>
    <option name="posroiID">active</option>
    <option name="posThresh">0.5</option>

    <option name="monitorNeg">false</option>
    <option name="negroiID">deactive</option>
    <option name="negThresh">-0.1</option>

    <option name="afterTriggerSkipTRs">10</option>
  </module>

  <!--  triggers events based on the difference between activation sums -->
  <module name="event-trigger-activation-diff">
    <output>infoserver</output>
    <output>display</output>
    <output>data.image.activation.voxel-fluctuationmonitor</output>

    <option name="monitorPos">true</option>
    <option name="posroiID">active</option>

    <option name="monitorNeg">false</option>
    <option name="negroiID">deactive</option>

    <option name="diffThresh">0.5</option>

    <option name="initialSkipTRs">20</option>
    <option name="afterTriggerSkipTRs">20</option>
  </module>

</processor>

